# トラブルシューティング

miniaudioNet を利用する際に遭遇しやすい問題とその対処法をまとめました。

## ネイティブライブラリがロードできない

- 症状: `DllNotFoundException` や `EntryPointNotFoundException` が発生する。
- 対処:
  1. `runtimes/<RID>/native/` に `miniaudionet` の DLL / SO / DYLIB が存在するか確認します。
  2. 開発環境でローカルビルドを利用する場合は、`artifacts/native/<RID>/native/` がコピーされているか確認します。
  3. .NET アプリの実行ディレクトリにネイティブファイルが配置されているか、または `PATH` / `LD_LIBRARY_PATH` が設定されているか確認します。

## 音が出ない / 再生開始しない

- 症状: アプリはエラーを出さないが音が再生されない。
- 対処:
  1. 音量 (`engine.Volume`, `sound.Volume`) が 0 になっていないか確認します。
  2. 出力デバイスが正しく選択されているか確認します。`EngineConfig` で明示的にデバイスを指定することもできます。
  3. 非同期初期化 (`SoundInitFlags.Async`) を使用している場合は、再生開始前に読み込みが完了したか確認します。

## ループ再生が途中で止まる

- 症状: ループ再生中に音が途切れてしまう。
- 対処:
  1. `sound.IsLooping = true;` が設定されているか確認します。
  2. PCM データを手動で供給している場合は、バッファのループポイントが正しいか確認します。
  3. 波形生成時に 0 クロスを意識したループを構築し、クリックノイズを避けてください。

## 再生中にノイズが乗る

- 原因: バッファ不足、サンプルレートの不一致、振幅のクリップなど。
- 対処:
  1. サンプルレートとチャンネル数が音源と一致しているか確認します。
  2. 動的に PCM を生成する場合は、十分なバッファを供給し、`Task.Delay` の間隔を短くします。
  3. 振幅が ±1.0 を超える PCM を生成していないか確認します。

## Windows でビルドが失敗する

- 対処:
  1. Visual Studio Build Tools で C++ ビルドツールがインストールされているか確認します。
  2. `cmake` が `PATH` に入っているか確認します。
  3. PowerShell スクリプトを実行する場合、実行ポリシーが適切に設定されているか確認します (`Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`)。

## macOS で `codesign` が必要と言われる

- 対処:
  1. 自前でビルドした DYLIB を配布する場合は `codesign` が求められることがあります。
  2. 個人利用であれば署名なしでも実行できますが、配布時は適切な署名を施してください。

## Linux で依存パッケージが不足している

- 対処:
  1. ALSA または PulseAudio の開発パッケージが不足している場合は、ディストリビューションのパッケージマネージャーからインストールしてください。
  2. `ldd` コマンドで依存関係を確認し、欠けているライブラリを導入します。

## それでも解決しない場合

- GitHub Issues で報告を受け付けています。環境情報 (OS / .NET バージョン / miniaudioNet バージョン) や再現手順、ログを添えて報告してください。
- 既存の Issue を検索し、同様の問題が報告されていないか確認してください。
